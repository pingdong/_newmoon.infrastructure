It's common to see in a pipeline that PowerShell scripts and HCL scripts work tightly and passing variables around through pipeline Yaml files. It is understandable as the evolution of each platform is in a fast pace, and the latency of supports by its provider of terraform. The limitation generates low readability, therefore increases the maintenance efforts. After a few years, the portability is compromised unnoticedly. Luckily the world changed, even the limits are still applied, it's eased significantly. My previous role gave me a chance to think how to improve it. But unfortunately, I haven’t had time to land it. 

I designed and built the repository of a common scenario to provide a workable solution.

The core service is an Azure Function App with required Storage Account and App Service Plan. An Azure App Configuration is used to share service configuration across all resources. An Azure Keyvault is used to protect the connection string of the App Configuration and uses the Keyvault reference to expose the connection string to the Function App. An App Insights is linked to the Function App.

In integration testing, it’s unnecessary to involve indirect resource to the testing resources. Therefore, Azure Keyvault is not necessary. But App Configuration is still valuable to share settings across different services and multiple integration tests of the same service. The App Insights is also needed to persist the testing logs for debugging purpose. Even the resource is destroyed after testing for cost saving. Recycling testing resources could pollute the testing itself. Another different is putting shared App Configuration and App Insight in a separate Resource Group reduces the maintain job. Cleaning testing resource is as simple as deleting the Resource Group that contains the testing resource. Appending suffix to the testing resources helps isolating multiple tests and increase productivity.

Base on the lessons I learned from terraform, concept and practice of general development. I built this repository to demonstrate a workable approach to answer the above challenge.
