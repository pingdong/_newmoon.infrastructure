trigger: none
pr: none

variables:
- group: Pipeline
- group: Management

stages:
# Management Resource
- stage: ManagementResource
  displayName: Deploy Management Resources
  jobs:
    - job: TerraformStateStorageBuild
      displayName: Build Terraform State Storage
      pool:
        poolImage: ${{ variables['pipeline#vmImage'] }}
      workspace:
        clean: all
      steps:
      - task: AzureResourceManagerTemplateDeployment@3
        displayName: Deploying
        inputs:
          deploymentScope: Subscription
          ConnectedServiceName: $(management#state.azure.connection)
          #azureResourceManagerConnection: Azure #${{ variables['management#state.azure.connection'] }}
          subscriptionId: $(management#state.azure.subscription)
          location: $(management#state.azure.location)
          csmFile: ./arm/azuredeploy.json
          csmParametersFile: ./arm/azuredeploy.parameters.json
